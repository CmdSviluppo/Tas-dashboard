<div class="score-display" [class]="'size-' + size">
  <div class="gauge-wrapper">
    <div
      class="gauge-container"
      #gaugeContainer
      [nbPopover]="breakdownTemplate"
      nbPopoverTrigger="hover"
      nbPopoverPlacement="top"
      [class.has-breakdown]="showBreakdown && breakdown">
    </div>

    <div class="score-info">
      <div class="timeframe-label" *ngIf="timeframe">{{ timeframe }}</div>
      <div class="confidence-badge" [style.background-color]="scoreColor">
        {{ confidencePercent }}
      </div>
    </div>
  </div>

  <div class="sparkline-wrapper" *ngIf="showSparkline && sparklineData">
    <div class="sparkline-container" #sparklineContainer></div>
  </div>
</div>

<!-- Popover Template (mostra solo se showBreakdown Ã¨ true) -->
<ng-template #breakdownTemplate>
  <nb-card class="breakdown-popover" *ngIf="showBreakdown && breakdown">
    <nb-card-header>
      <h6>Strategy Contributions</h6>
    </nb-card-header>
    <nb-card-body>
      <div class="breakdown-content">
        <div *ngFor="let entry of breakdownEntries" class="strategy-row">
          <span class="strategy-name">{{ entry.key }}</span>
          <div class="strategy-values">
            <span class="strategy-score" [style.color]="entry.value.score >= 0 ? '#00C853' : '#FF3D71'">
              {{ entry.value.score >= 0 ? '+' : '' }}{{ entry.value.score }}
            </span>
            <span class="strategy-confidence">
              ({{ (entry.value.confidence * 100).toFixed(0) }}%)
            </span>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>
