<div [class]="'size-' + size" class="score-display">
  <div class="gauge-wrapper">
    <div
      #gaugeContainer
      [class.has-breakdown]="showBreakdown && breakdown"
      [nbPopover]="breakdownTemplate"
      class="gauge-container"
      nbPopoverPlacement="top"
      nbPopoverTrigger="hover">
    </div>

    <div class="score-info">
      <div *ngIf="timeframe" class="timeframe-label">{{ timeframe }}</div>
      <div [style.background-color]="scoreColor" class="confidence-badge">
        {{ confidencePercent }}
      </div>
    </div>
  </div>

  <div *ngIf="showSparkline && sparklineData" class="sparkline-wrapper">
    <div #sparklineContainer class="sparkline-container"></div>
  </div>
</div>

<!-- Popover Template (mostra solo se showBreakdown Ã¨ true) -->
<ng-template #breakdownTemplate>
  <nb-card *ngIf="showBreakdown && breakdown" class="breakdown-popover">
    <nb-card-header>
      <h6>Strategy Contributions</h6>
    </nb-card-header>
    <nb-card-body>
      <div class="breakdown-content">
        <div *ngFor="let entry of breakdownEntries" class="strategy-row">
          <span class="strategy-name">{{ entry.key }}</span>
          <div class="strategy-values">
            <span [style.color]="entry.value.score >= 0 ? '#00C853' : '#FF3D71'" class="strategy-score">
              {{ entry.value.score >= 0 ? '+' : '' }}{{ entry.value.score }}
            </span>
            <span class="strategy-confidence">
              ({{ (entry.value.confidence * 100).toFixed(0) }}%)
            </span>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>
